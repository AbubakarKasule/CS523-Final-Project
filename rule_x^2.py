import numpy as np
import random
import matplotlib.pyplot as plt
from MultiDimensionalCellularAutomaton import MultiDimensionalCellularAutomaton

def perfect_memory_neighborhood(j):

    res = []

    for i in range(8):
        res.append(i)

    for i in range(8):
        res.append(i - j)

    return res


dimensions = (8,)
base = 2

# Target Function
def f(x):
    return x**2

p= len(perfect_memory_neighborhood(0))

correct = 0
total = 0
pop_size = 8
results = []


print("Neighborhood found")
x = MultiDimensionalCellularAutomaton(perfect_memory_neighborhood, 
                                    neighborhood_size=p, 
                                    color_palette_idx=int(random.randint(0, 170)), #sn.color_palette("viridis", base), 
                                    base=base, 
                                    dimensions=dimensions, 
                                    rule=228517284526081819071897842917071291636737363082469312429637153310726064791312223050375030244975413356115058363621181802486479508766962020329532496486857660388713340779555017078821623996144721392483411722634154301726046703514794891726142485012425619633091521032342370253449369930336372864535769519604875875090448530057882078336708816467270861610584894470234183181737393194966910742610495272217632768756454591753363655749528471960419748563725807960941925150201760129738479822274748819611788623123742679133325687905017733299118199368424071033249025015318699739191266905588421594620454244512453574517781093495137932458187587711163411515358865408632922231596165776863115820346098171198984750873668273095645710365807790203380854650018499737868256111129494463539608014932770411798218905881229819380999125426037061633422046333798330465544202074066670565703104169935946021348459521365074640579143791332724244555370172222123271145617595112371830218742942650981466473686454573239083802670964522243453620107191856291489250295351240989750684818769742671069029477561903028217398590693258766204967758452777137587273295240979272576649039182522837906982656309287387495263516607954482988012052755351479845308295944306960565497441981122927342914244708853024270929849663733041245533002657774279204495230527330830047953247743509569762140535791255694687385023364009354451817776578321042760703549273789543204843481820073196151976704447599070880583514830799417719328284810746002900518122158922892690031766815304738947476551547012634954049437574100794854148728982994914641805411308778722139979192961289524806109778269007458492028593017112249140563744367611066264344793637744649062266152509952356356392762124010839669611746750060631155903421375200690423196398742546686246289222538452105967187211251532876317908995136274541574005435889018237425374929707957218610677814004730514881622338487077896307722528778782611163561725919701927230711490936062673810285952990216688740333185570446261883514018481632194425366958002511399662779979873112658434222605607412453389423101259289111148698794866302099948656238151537435103605706484025869320291539264961280179280299744980232104105230026365589874556443524090875885355395939040066589476197623490085042720210615694128692517124035413637655471417839126216486948398195745229147789564861740575166885404814119451302230688610182944346372239179927563671738764531237564802972746791542859651177570555065881658338641168196469300595966639055339456063750786137241208329538049046722491413439227882240546583869186200917410292524615607656851917186542503345970020176296776969894212047429845907008440090753219829949041301148289458803524802089177175796874330282720474015538134902449520245760320273916202767664610202025427238898528310710364432349701672212495114811062534395879658412639365142093870563141888382488054565579306959415289167613267592160594946469542254750753873690407523077168281588378504120641453274287673029198996280362323720533533638532233546192720635007577121995614469943046979949893191444495989983435907528254054377785781549147972676727945021548631873696206793664896469145539060367480807736694759921386034303907815698068147977450754715287900586545330708699593694315700635556832402958156023532954920775309997159992844610157589248446033664217243694295068465197345750423150171608200761736950006193169215982539727029544854695355831630425665435431196751773311588764288595512068778794436418311164981390549017252425466505908715127960869677445386827094791986326097814705660913553081785582495114677846919305168464843821870247331058147544686463327426910169999202611088383833154002507266365656319794384316729148987778840255337212080924252275847653901617321308328869822390775260021969123192349274960230073202276732157693428352207228944620637149582885906904786627222955187070339076769329906234569018889936164604882790966686240669517293272003462438467559760528549958022317002696354537516075386647049201556418463894818337243609448625666049303893596689111123248793552780768165186779170050892525256379590197782359858552826141400771993295409624558301855935901597330221779610026857145879003159527356970479520261599634941483405358360355704192190411261474466932100266185665730415716516484296266875000069836654564693967053339422452414875335603217429782230750785299940311705834938202497047135298515151912842516360242788932047935426750227294312702794746364599355575447046459916893711855601184918349980925302955526391254183407223666286979039507952516022329678079149083031550791267668896420591221187445378567615342700131804415151523011897709965221536151495252583763977149048456135954128934113650998078857106870717402512167400302253800977006169591329456817811086322745563501111603205896805798107899178962572362681610227302126330252933327002814547917467150020889709427404377443194700457069587579790675627781371854878301156773106793247189695048646896422873297660739919213533226868248190785150741772005930365597807010142866867226079010031650450023773818661777965031673842769146105609272790426050640641701571753871141733904990319747406963811571734110384170064964364381736333821015199221159961146104947831671719943921737767139616517853741282009010038501938181623152234296724966114228510888586933343132325532511988309573810980878607217810740664087744441234403673152126172760890277104172746610234303187560915667044671378818601553964380261338310986279029856648915026893178622325133129028983791923660043057318164751306250368609628119785578055940133168511188155399861559392889469122796618850371948245419792990909011844686565214869019925335209477090763661506335349106451203813043828757361195270956541172983166435778773874636796644736873377206625301869340777783719615005635131215028819942797106428596614866754111315354897055562101672676792497990371828712585019393063197009492129620073685411786643534567968069479004038691424251707996851250436759477305030243929151534863068752434086993300170868475264888513504643478650668004863939941765531799646637777682902472462846405155650490898348761082657975891907339669631048580653336965149793017246008093177820661034418510914019943277229629908482160209322101190912188426347781440979808527124764731797240457797636304626330617204679411184983668661034175566647821842610823974480567334151598887404123599111671910508452024254052135599678604051799896684663120099921655693133731940199812062356412947382126871961817653635890668512270523583820311763049091469648449768904178202984204874553666878928229867915485223739166633334783337329113878353993115832760867853991620071973798189100772431403202804461143754402725967410222821186047872194815328014937113776934651215429570450712972822459090463263944136877912236975117669772257041702587369172540929983017995852290629185283620799274185641600830881871712363959938997335682908258246601184626914755973205326952944060122348111725275640879020792360240796044120702451827057189339971602241193215860373502917887714979041530151898143617150871425474418897445468101853613159530869977002822287052176264910382194336801725709211168396612089168048480017944794516666954238096293389234023573010032279490868677841995937536258891532584926051643559032426357726184887286496127360450456395056685931118587021790165029226751148236473007926724160743333473663566413845873527652690125710051099650813872165982641282208863035054221246732170656607742713337707377206567866258808928332220319355657554874449136531532481333739630948014955394713828390231025768683262887248948004469741424602945161564078031973962463659597404331161505735682680166191105751083729154065082581840653397696339379930996518216641954952623539774191821146196187224855013266776112428904144581540772331854277363909324948528816006097084110884318881943949404659362605421106190811683512677282619385730686765853268972732920581258055413805092218480227916665275677464049105993263208135620504554928086844054129121378578146497134480849522319572692269444622983364062605318294012809250436324974499340643116496598968914671534212144402396697407011388854701710445248980404727881768654985087629803389877776380321817399158228797952855598239476394237475432076721414966975176160256773066261319988339255553404050477002620750239135626181417820789311989456874529190410067306740579210671339769191425076627761410525579252156737233054442842265403298011933356980706525944798148166324853899639532714094632699619628192846905010078388374118923261898878195676189459960563420011501249473607907764128315781959560853659540661820484733668752100653109719085659821681749781719806885384651412075057881625343489584957811445586466202198640076306478982005648972099831939307601895237121283096421990640948121587956795878431165224272119457193331933395847793321403683085709864052515475441131955988736196418746864970688146245732006687004183329087861841162293333168535044410157077007935028522637048719199650163481140233075909352829819011222433487445407030768761579843662730213272056592225690683491323556963406488899685277806630543573516004056870255095562619946480346007527824559060933616215201008239705577925025217140335814990941064063594412883820497900218678918624955453577864351533986827603528992183988195217737900426350206995439517977165446259848548849033683193333397912661470757711888051526311437253696285226032863106964197548559605748292823639154839883584802387510625603638043384725776647712797969856045019510192370098481962605203455309702630795599827900019022931056128225818766400334334874867564401484168677486683211652271801027278230859335016810464795902052361447401602935766856773594076050424707540724097674942470816721964483456589044454334243357690383924747816669582990724543080386374148103774159003793283675875285673106447458407928715145665769896493369014815390380282801031457325014337881283810813906303714034192177263419450519440971015562217479045365751662094575760627195706869352505871518973976631670424737983164929415908029990749907860552552046832636023120919927439202451956340903105671165529145662910171344895424270817016980244233608306844722677698969917062024094085324411874530450335769279220587613277537504414544122252452695150898329986516553924230348883797530791469021259241447174436560173576498814159751184271117827755161968052550963294656904783796642814655364323174142902963938042631411272126352834715641989776932179351245945662147804986454658785559984137656183950259365114847914348681643875487342642267753275111505180902380062116656751557890859643327637364550202194676402332201093232683289586578084711276309012342900689787241913027493381623391218875020792027551914762635537800763210868059811226234643302991167127633841716180578895718395090973440608874862144308604074683216731183253967828890610148263730573872367526430777635249999212525561574214429877980644321167471532005649143991158443498108851003994890265169276282613418342053533956855018557379098379468609914540318227357420900078011606507109297431626056812560811141076834729139202035145409649159707392537717425486315151750346666963548810881066556219936669396329162597838470715783164932054449925392451176565075043108776541027408591857846852727557136659802358906812103094176828509950452762424544096356323827705219119456946315356865202242130746295153653200917801540763491323486630700877431517810321390432023838173655386196153654794492535235551693910499903986327496989422532723881564693951158024514651643426008661895387728996350627898881214825760659030261613609214929052473964119649523025750695652955269174745876428621391768617434037062931766604146268419161899308740714693697065584080347524683711656806814936252043108818820285123379772510073212005660294353357703236316514549944300742427670542596868701220786472643177933439284009228764209975229240514540586551625116242825898851389741221130327582637404765802784450294268822384085291900794977238150663137971041329699186250143056368377293549819307707650472199485612705712509610321797280927854621727199048576054890010042816942501342217104616628036409353176606694420826662909738132651948107122414598465218360628625021586138935571096028165782416114517352169155155069909026631602293612946908458593623145282105899546103892900245721165036388115366050497103068418646473598378996766399287713452846463271602254990428607159556754088874013371174332046404291825276447336482888161006163331597534618606141943482903256898623195204709767277913281743072304541747057997734033103604088487288740914179834278649574655882826319833465819463644246552318898631703108379068999251261890909953527260683930074507220630603549195204802310102745269936895025992745999143241193360690648942143398475304691020673795846525074340135310653858009198095268466487580460294404886510017823138917658903895388923762479883814417497643849195344016289639031411514623129656788773131837605142505098649329587799021594661866607432557787984480683509629119183430064137348696194408954925190391423246025282900901469842760927967137687559671958983343694521200101394160856168507607838475413687154286981457706420693324992441608616761688730483655666264567662773393878823063094459207258341022803264898815435782897874529390927544826204396199267444338933493859170615677106708399704378230193281993713451300410404886010837838719594564149940005218218040419626402960854576698651056456296866881678294193817675068979348840032125615380092193227933179007083901041052004817578526588350907063683215168912584462100308317363924713789608243873612426469662048930756441751249862654277190463869929313456645041978727897503731500054570877721261970720429992675063044337909857345506519692591473496335174652423469275070682929739703090667865960179641928066874383080804411768520227706528857529129170876912278646954356387399037267100261042927297043939379305408490778399752488746669210723247360843303836804168282139969286278821245983918011135327645238232280966053873148769627206479210338262068135185094690171363458846370095183452069905564642332315590036459978648998435995842418625336449202261120164188429257853049632037942074131604122161493819108949961010873905474042562717224712093202596014787248354560723347068577283006816644740059533965083611543223590035352850164284875533129317014975141745887119622228370983178992287812202911221176888117490140876868329642859636129568133105592032300826131917613324705931617899914055004253834406979741198295414608136545862832879222664192868473602524707631073836205842424981132579975118397545156626259757344339900892367077645133731327730505422416354245043436962224526351644299371839919484188896183439620630276493927319266709859082369631667467646498011849805661590991288925893550972954497936939835740141969541116896044792466506513119396442187955556160062590034824130561469194141275220399174218311354916855137118868468843970043891065725815167192764194186598330600516283712852482954638747485745126004616832729121432008770785880112707290454179761155543246406721891879134244211069687738821408550535325883418290177752209465997676390804483373069325713837064231867345381916886197175484924510145580670222961468786651846924435538603294731962006922001392411377155824481449534994199634576853479705269484429553399685554271301680163471588585012612438947263142467593524349360776786327277625511926191530567864630755324291858024099138783222172360773249853197625183810055710682026743508072851928168491532952319938110306647485434735250145992942685853774005373122976184467373472593720778405887355039785316712904344130497236227478720303565439304150735046962015812002676621984045484565645937345357502700318136646344737885294845285962756311764813228330423488025926397523042795764311775419115524318934318213285747222756919550974244270326449925796611850297778131067297968230453991203954060236912450968914055759755124469066323341742648793832691990185370048423745365897334144233621712342522093922797550267619507744036354341412603140651124722026674140870264435296343468762600611383498849437917521316966635233816742867697715437595618817582690680468217444758080625026556605050566641010716695130149426250847081914657368966763944076026050400006963163450936837982844259932683203125255384074204915862873332439560208055320682513278402438634619499288764973061135647444263791981746013514396611467215281306635226168242154496592862542101207873054226211462013032530844776697663181206976077814532417874868533717585998342788955500867235931192774982566895555162685243479507698253820903594245453467285599558883974329575096140706715002515436407154412382209781954114293197050273601481789743578437909476129328407977574792290053636231698149503293251908951140949444881917935827889581009224453866838562544210350513210559319123184093660873529514492527572466990646965711275079116021554554443735443232141894293465760071937274833889819524239050184894293639358651438962441541636978027816227818104456682974602231573770263109840542867001729153846121391922385087373989473623422338064670244747612651152313315799307501357968617346094962383807655650972790678916142551165945425180880644920447523710580221246378066148384328211898534508390193189081326843031221739068144104163423178865007107825884489230536949216481185521497838140532167918476246670644717857786949109303712695838598193212468312520489461114908852926753692099033595285934565261233479704798550409279741521606513354131464887426222649283602910493644585960169918639405811120523330703433870475139963804749604508599431525125937033297137836003680017353017605555543648353773287418953573054872548757295294670276931994739513206272423586822821740478578460511792627756952329148383575687260258164587292235616259539981438522865540066646757964541330090876095137847238702247883483777421139956026722862925708134016756402866412002685180078956963047206803990583862938276906127307185597332911698969189797007674126042533548267686060392715156964166200469938315755996200226074110526296084322993890705818463669879000309027206892649503406155681739508646834935602775086409202392223055924866206090743478053381876804169973104630745093982729417095497191755131960209738703731146252812670537272064294305385744628132029448090251027057875615468687265953178739111745084741854508607598725019234354262000784225709278945949794438471386965959370174582083585326669201196871859747185200295421614757028290090855018578902929506723258854466788677994011915842238935922693266657364251956792603212244127353698558520778736919900640440576350115033242267582368982026252101548785056817471762834623046791810829164246732597937141635431959928600877260663907060381373318579375445215173370618380287321456690657743434261843542531505189197698779980325432835819651677375663139630825745393194677886760921435275198556695426621705850340637142576282427263116244306063713623777349203307585930171083094910824348745263327344310749443064075494695458338280540786445471880918054580659618421443816711630194217938698182973350320510422237606261601548388663700895605830330309061449297807757543391176347949616802573151624530490221279376486250273369623476815990819368806277809306558081926175553179911573863924626359501392077429206977347597876404141552641058854112166411907171228418199620960752355902623072923867740432286501018473933733521675595939442054744325114494589238139881188153955873821909234012668509302116055718227437704521033691465126854658943640692641214192353878211928657099546839676719495140224615332618750514198254287939195802310944909321883652730548555409687073533648564676880526403368463203998601439271975206077920493140119824365263060928462059116802820675259733519750802836348123820915549562279920359426462904836663813779931099380981263117177673237148974109097537487269149684448384782806420216983069771550360548174016609587419623682457954890806369859693715939165135960917438484628347848870383424248388979948455383421398918369949003005073392123384142665147664949260377319399767668149962085395101145892863149163754095236151761967382046372866030992284694940816398638603137661038635002627376870804539046969106452778110206376858502025008787834666169113355367897288221221460458041456004616575092664,
                                    init_pop=['0', '1', '0', '1', '0', '1', '0', '1']) #generate_random_2d_pop(base, dimensions))


for n in range(100):
    # Reset
    input_list = list([i for i in str(np.base_repr(n, base=base)).rjust(pop_size, "0")])
    x.history = list([input_list])

    x.iterate(1, surpress_print=True)

    automata_answer = ""

    for j in x.return_latest_generation():
        automata_answer += j

    automata_answer = int(automata_answer, base)

    results.append(automata_answer)

    if f(n) % 256 == automata_answer:
        correct += 1


    total += 1


print("Accuracy: ", str(correct/total)[:4] + "%")



plt.plot(list(range(100)), results, label = "CA Model")
plt.plot(list(range(100)), [f(x) % 256 for x in range(100)], label = "Target Function")
plt.legend()
plt.savefig("Approximation graph x^2Extended.png")




